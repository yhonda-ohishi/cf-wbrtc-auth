"use strict";(()=>{var M=Object.defineProperty;var O=(r,e,n)=>e in r?M(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var i=(r,e,n)=>O(r,typeof e!="symbol"?e+"":e,n);var f=class{constructor(e,n=null){i(this,"ws",null);i(this,"wsUrl");i(this,"token");i(this,"reconnectAttempts",0);i(this,"maxReconnectAttempts",10);i(this,"reconnectTimeout",null);i(this,"isManualDisconnect",!1);i(this,"isAuthenticated",!1);i(this,"onAuthenticated",null);i(this,"onAuthError",null);i(this,"onAppStatus",null);i(this,"onAppsListReceived",null);i(this,"onOffer",null);i(this,"onAnswer",null);i(this,"onIce",null);i(this,"onConnected",null);i(this,"onDisconnected",null);i(this,"onError",null);this.wsUrl=e,this.token=n}async connect(){if(!(this.ws?.readyState===WebSocket.OPEN||this.ws?.readyState===WebSocket.CONNECTING))return this.isManualDisconnect=!1,new Promise((e,n)=>{try{let t=new URL(this.wsUrl);this.token&&t.searchParams.set("token",this.token),this.ws=new WebSocket(t.toString()),this.ws.onopen=()=>{this.reconnectAttempts=0,this.onConnected?.(),this.sendAuth(),e()},this.ws.onmessage=s=>{this.handleMessage(s.data)},this.ws.onerror=s=>{console.error("WebSocket error:",s),this.onError?.({message:"WebSocket error occurred"}),n(new Error("WebSocket connection error"))},this.ws.onclose=s=>{this.isAuthenticated=!1,this.onDisconnected?.(),this.isManualDisconnect||this.scheduleReconnect()}}catch(t){n(t)}})}disconnect(){this.isManualDisconnect=!0,this.isAuthenticated=!1,this.reconnectTimeout!==null&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws?.readyState===WebSocket.OPEN&&this.isAuthenticated}sendAuth(){this.send({type:"auth",payload:{token:this.token}})}sendOffer(e,n){this.send({type:"offer",payload:{targetAppId:e,sdp:n}})}sendAnswer(e){this.send({type:"answer",payload:{sdp:e}})}sendIce(e,n){this.send({type:"ice",payload:{candidate:e,targetAppId:n}})}getApps(){this.send({type:"get_apps",payload:{}})}send(e){if(this.ws?.readyState!==WebSocket.OPEN){console.error("WebSocket is not open. Cannot send message:",e);return}try{this.ws.send(JSON.stringify(e))}catch(n){console.error("Failed to send message:",n),this.onError?.({message:"Failed to send message"})}}handleMessage(e){try{let n=JSON.parse(e);switch(n.type){case"auth_ok":this.isAuthenticated=!0,this.onAuthenticated?.(n.payload);break;case"auth_error":this.isAuthenticated=!1,this.onAuthError?.(n.payload);break;case"apps_list":this.onAppsListReceived?.(n.payload);break;case"app_status":this.onAppStatus?.(n.payload);break;case"offer":this.onOffer?.(n.payload);break;case"answer":this.onAnswer?.(n.payload);break;case"ice":this.onIce?.(n.payload);break;case"error":this.onError?.(n.payload);break;default:console.warn("Unknown message type:",n.type)}}catch(n){console.error("Failed to parse message:",n),this.onError?.({message:"Failed to parse server message"})}}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.onError?.({message:"Failed to reconnect after multiple attempts"});return}let e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,console.log(`Reconnecting in ${e}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimeout=window.setTimeout(()=>{this.connect().catch(n=>{console.error("Reconnection failed:",n)})},e)}updateToken(e){this.token=e,this.ws?.readyState===WebSocket.OPEN&&(this.disconnect(),this.connect().catch(n=>{console.error("Failed to reconnect with new token:",n)}))}};function R(r){let e=r.data.length,n=new Uint8Array(5+e);return n[0]=r.flags,new DataView(n.buffer).setUint32(1,e,!1),n.set(r.data,5),n}function b(r){let e=[],n=0;for(;n<r.length;){if(n+5>r.length)return{frames:e,remaining:r.slice(n)};let t=r[n],a=new DataView(r.buffer,r.byteOffset+n+1,4).getUint32(0,!1),c=n+5+a;if(c>r.length)return{frames:e,remaining:r.slice(n)};let d=r.slice(n+5,c);e.push({flags:t,data:d}),n=c}return{frames:e,remaining:new Uint8Array(0)}}function T(r){return{flags:0,data:r}}function D(r){let n=new TextDecoder("utf-8").decode(r),t={},s=n.split(`\r
`);for(let a of s){if(!a.trim())continue;let c=a.indexOf(":");if(c===-1)continue;let d=a.substring(0,c).trim().toLowerCase(),l=a.substring(c+1).trim();t[d]=l}return t}var A={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16};function L(r){let e=new TextEncoder,n=e.encode(r.path),t=n.length,s=JSON.stringify(r.headers),a=e.encode(s),c=a.length,d=T(r.message),l=R(d),p=4+t+4+c+l.length,h=new Uint8Array(p),g=new DataView(h.buffer),u=0;return g.setUint32(u,t,!1),u+=4,h.set(n,u),u+=t,g.setUint32(u,c,!1),u+=4,h.set(a,u),u+=c,h.set(l,u),h}function k(r){let e=new TextDecoder("utf-8"),n=new DataView(r.buffer,r.byteOffset),t=0;if(t+4>r.length)throw new Error("Incomplete response: missing headers length");let s=n.getUint32(t,!1);if(t+=4,t+s>r.length)throw new Error("Incomplete response: missing headers");let a=r.slice(t,t+s),c=e.decode(a),d=JSON.parse(c);t+=s;let l=r.slice(t),{frames:p,remaining:h}=b(l);if(h.length>0)throw new Error("Incomplete response: partial frame remaining");let g=[],u={};for(let m of p)if(m.flags===0)g.push(m.data);else if(m.flags===1)u=D(m.data);else throw new Error(`Unknown frame flags: ${m.flags}`);return{headers:d,messages:g,trailers:u}}function y(r){let e=r.trailers["grpc-status"];return e?parseInt(e,10)!==A.OK:!1}function I(r){if(!y(r))return null;let e=parseInt(r.trailers["grpc-status"]||"2",10),n=r.trailers["grpc-message"]||"Unknown error";return{code:e,message:n}}var C=class extends Error{constructor(n,t,s){super(t);this.code=n;this.trailers=s;this.name="GrpcError"}},v=class{constructor(e){i(this,"dataChannel");i(this,"pendingRequests",new Map);i(this,"requestIdCounter",0);i(this,"closed",!1);this.dataChannel=e,this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",this.handleMessage.bind(this)),this.dataChannel.addEventListener("close",this.handleClose.bind(this)),this.dataChannel.addEventListener("error",this.handleError.bind(this))}async unary(e,n,t,s,a){let c=t(n),l={"x-request-id":this.generateRequestId(),...a?.headers||{}},p={path:e,headers:l,message:c},h=await this.call(p,a);if(h.messages.length===0)throw new Error("No response message received for unary call");if(h.messages.length>1)throw new Error(`Expected single response message, got ${h.messages.length}`);return{message:s(h.messages[0]),headers:h.headers,trailers:h.trailers}}async call(e,n){if(this.closed)throw new Error("Transport is closed");let t=e.headers["x-request-id"];if(!t)throw new Error("Request envelope must include x-request-id header");let s=n?.timeout||3e4,a=new Promise((l,p)=>{let h=setTimeout(()=>{this.pendingRequests.delete(t),p(new Error(`Request timeout after ${s}ms`))},s);this.pendingRequests.set(t,{resolve:l,reject:p,timeout:h})}),c=L(e);try{this.dataChannel.send(c)}catch(l){let p=this.pendingRequests.get(t);throw p&&(clearTimeout(p.timeout),this.pendingRequests.delete(t)),l}let d=await a;if(y(d)){let l=I(d);throw l?new C(l.code,l.message,d.trailers):new C(A.UNKNOWN,"Unknown error",d.trailers)}return d}close(){if(this.closed)return;this.closed=!0;let e=new Error("Transport closed");for(let[n,t]of this.pendingRequests.entries())clearTimeout(t.timeout),t.reject(e);this.pendingRequests.clear(),this.dataChannel.readyState==="open"&&this.dataChannel.close(),this.dataChannel.removeEventListener("message",this.handleMessage.bind(this)),this.dataChannel.removeEventListener("close",this.handleClose.bind(this)),this.dataChannel.removeEventListener("error",this.handleError.bind(this))}generateRequestId(){return this.requestIdCounter++,`req-${Date.now()}-${this.requestIdCounter}`}handleMessage(e){if(this.closed)return;let n=new Uint8Array(e.data);try{let t=k(n),s=t.headers["x-request-id"];if(!s){console.error("Received response without x-request-id header");return}let a=this.pendingRequests.get(s);if(!a){console.warn(`Received response for unknown request ID: ${s}`);return}clearTimeout(a.timeout),this.pendingRequests.delete(s),a.resolve(t)}catch(t){console.error("Failed to decode response:",t)}}handleClose(){if(this.closed)return;let e=new Error("DataChannel closed");for(let[n,t]of this.pendingRequests.entries())clearTimeout(t.timeout),t.reject(e);this.pendingRequests.clear(),this.closed=!0}handleError(e){console.error("DataChannel error:",e)}get channel(){return this.dataChannel}get isClosed(){return this.closed}get pendingCount(){return this.pendingRequests.size}};var x=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}],E=class{constructor(e,n=x){i(this,"signalingClient");i(this,"peerConnections",new Map);i(this,"iceServers");i(this,"onDataChannelOpen",null);i(this,"onDataChannelClose",null);i(this,"onDataChannelMessage",null);i(this,"onConnectionStateChange",null);i(this,"onError",null);this.signalingClient=e,this.iceServers=n,this.setupSignalingHandlers()}setupSignalingHandlers(){this.signalingClient.onAnswer=e=>{let{sdp:n,appId:t}=e;this.handleAnswer(t,n)},this.signalingClient.onIce=e=>{let{candidate:n,appId:t}=e;t&&this.handleIceCandidate(t,n)},this.signalingClient.onAppStatus=e=>{e.status==="offline"&&this.disconnect(e.appId)}}async connectToApp(e){if(this.peerConnections.has(e)){let a=this.peerConnections.get(e);if(a.dataChannel?.readyState==="open")return a.dataChannel;this.disconnect(e)}let n=new RTCPeerConnection({iceServers:this.iceServers}),t=n.createDataChannel("data",{ordered:!0}),s={pc:n,dataChannel:t,transport:null,appId:e};this.peerConnections.set(e,s),this.setupPeerConnectionHandlers(e,n),this.setupDataChannelHandlers(e,t);try{let a=await n.createOffer();return await n.setLocalDescription(a),this.signalingClient.sendOffer(e,a.sdp),new Promise((c,d)=>{let l=setTimeout(()=>{d(new Error("Data channel connection timeout")),this.disconnect(e)},3e4);t.onopen=()=>{clearTimeout(l),s.transport=new v(t),this.onDataChannelOpen?.({appId:e}),c(t)},t.onerror=p=>{clearTimeout(l),this.onError?.({appId:e,message:`Data channel error: ${p}`}),d(p)}})}catch(a){throw this.disconnect(e),this.onError?.({appId:e,message:`Failed to create offer: ${a}`}),a}}disconnect(e){if(e){let n=this.peerConnections.get(e);n&&(this.closePeerConnection(n),this.peerConnections.delete(e))}else{for(let[n,t]of this.peerConnections.entries())this.closePeerConnection(t);this.peerConnections.clear()}}sendMessage(e,n){let t=this.peerConnections.get(e);if(!t?.dataChannel){this.onError?.({appId:e,message:"No data channel available for this app"});return}if(t.dataChannel.readyState!=="open"){this.onError?.({appId:e,message:`Data channel is not open (state: ${t.dataChannel.readyState})`});return}try{t.dataChannel.send(n)}catch(s){this.onError?.({appId:e,message:`Failed to send message: ${s}`})}}getConnectionState(e){return this.peerConnections.get(e)?.pc.connectionState||null}getDataChannelState(e){return this.peerConnections.get(e)?.dataChannel?.readyState||null}getConnectedApps(){return Array.from(this.peerConnections.keys()).filter(e=>this.peerConnections.get(e)?.dataChannel?.readyState==="open")}getTransport(e){return this.peerConnections.get(e)?.transport||null}getDataChannel(e){return this.peerConnections.get(e)?.dataChannel||null}async handleAnswer(e,n){let t=this.peerConnections.get(e);if(!t){console.warn(`Received answer for unknown app: ${e}`);return}try{let s=new RTCSessionDescription({type:"answer",sdp:n});await t.pc.setRemoteDescription(s)}catch(s){this.onError?.({appId:e,message:`Failed to set remote description: ${s}`})}}async handleIceCandidate(e,n){let t=this.peerConnections.get(e);if(!t){console.warn(`Received ICE candidate for unknown app: ${e}`);return}try{await t.pc.addIceCandidate(n)}catch(s){this.onError?.({appId:e,message:`Failed to add ICE candidate: ${s}`})}}setupPeerConnectionHandlers(e,n){n.onicecandidate=t=>{t.candidate&&this.signalingClient.sendIce(t.candidate,e)},n.onconnectionstatechange=()=>{let t=n.connectionState;this.onConnectionStateChange?.({appId:e,state:t}),(t==="failed"||t==="closed")&&this.disconnect(e)},n.oniceconnectionstatechange=()=>{let t=n.iceConnectionState;(t==="failed"||t==="closed")&&this.onError?.({appId:e,message:`ICE connection ${t}`})},n.ondatachannel=t=>{console.warn("Unexpected data channel from remote peer:",t.channel.label)}}setupDataChannelHandlers(e,n){n.onopen=()=>{this.onDataChannelOpen?.({appId:e})},n.onclose=()=>{this.onDataChannelClose?.({appId:e})},n.onmessage=t=>{this.onDataChannelMessage?.({appId:e,data:t.data})},n.onerror=t=>{this.onError?.({appId:e,message:`Data channel error: ${t}`})}}closePeerConnection(e){let{pc:n,dataChannel:t,transport:s,appId:a}=e;if(s)try{s.close()}catch(c){console.error("Error closing transport:",c)}if(t)try{t.close()}catch(c){console.error("Error closing data channel:",c)}try{n.close()}catch(c){console.error("Error closing peer connection:",c)}this.onDataChannelClose?.({appId:a})}};var W="/grpc.reflection.v1alpha.ServerReflection/ListServices",S=class{constructor(e){i(this,"transport");this.transport=e}async listServices(e){return(await this.transport.unary(W,new Uint8Array(0),t=>t,t=>{let s=new TextDecoder().decode(t);return JSON.parse(s)},e)).message}static getMethodPath(e,n){return`/${e}/${n}`}};function o(r,...e){console.log(`[ReflectionUI:${r}]`,...e)}var w=class{constructor(){i(this,"signalingClient",null);i(this,"webrtcClient",null);i(this,"reflectionClient",null);i(this,"apps",new Map);i(this,"userInfo",null);i(this,"connectedAppId",null);i(this,"loginSection");i(this,"userSection");i(this,"appListSection");i(this,"reflectionSection");i(this,"userEmailSpan");i(this,"appSelectElement");i(this,"wsStatusSpan");i(this,"logoutBtn");i(this,"connectBtn");i(this,"resultsDiv");i(this,"statusDiv");o("constructor","Initializing ReflectionUIManager"),this.initializeDOM(),this.checkAuthStatus()}initializeDOM(){this.loginSection=document.getElementById("login-section"),this.userSection=document.getElementById("user-section"),this.appListSection=document.getElementById("app-list-section"),this.reflectionSection=document.getElementById("reflection-section"),this.userEmailSpan=document.getElementById("user-email"),this.appSelectElement=document.getElementById("app-select"),this.wsStatusSpan=document.getElementById("ws-status"),this.logoutBtn=document.getElementById("logout-btn"),this.connectBtn=document.getElementById("connect-btn"),this.resultsDiv=document.getElementById("results"),this.statusDiv=document.getElementById("status"),this.logoutBtn.addEventListener("click",()=>this.handleLogout()),document.getElementById("login-btn")?.addEventListener("click",()=>this.handleLogin()),this.connectBtn.addEventListener("click",()=>this.handleConnectAndList())}async checkAuthStatus(){o("checkAuthStatus","Checking auth status...");try{let e=await fetch("/api/me");o("checkAuthStatus","Response status:",e.status),e.ok?(this.userInfo=await e.json(),o("checkAuthStatus","User info:",this.userInfo),this.showUserInterface(),this.initializeWebSocket()):(o("checkAuthStatus","Not authenticated, showing login"),this.showLogin())}catch(e){console.error("Auth check failed:",e),o("checkAuthStatus","Error:",e),this.showLogin()}}clearToken(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("token")}showLogin(){this.loginSection.style.display="block",this.userSection.style.display="none",this.appListSection.style.display="none",this.reflectionSection.style.display="none"}showUserInterface(){this.loginSection.style.display="none",this.userSection.style.display="block",this.appListSection.style.display="block",this.reflectionSection.style.display="block",this.userInfo&&(this.userEmailSpan.textContent=this.userInfo.email)}handleLogin(){window.location.href="/auth/login"}handleLogout(){this.clearToken(),this.signalingClient&&this.signalingClient.disconnect(),this.webrtcClient&&this.webrtcClient.disconnect(),this.showLogin()}async initializeWebSocket(){let n=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;o("initializeWebSocket","WebSocket URL:",n),this.signalingClient=new f(n),this.signalingClient.onConnected=()=>{o("WS:onConnected","WebSocket connected"),this.updateWSStatus("connected")},this.signalingClient.onDisconnected=()=>{o("WS:onDisconnected","WebSocket disconnected"),this.updateWSStatus("disconnected")},this.signalingClient.onAuthenticated=t=>{o("WS:onAuthenticated","Authenticated:",t),this.updateWSStatus("authenticated"),o("WS:onAuthenticated","Requesting app list..."),this.signalingClient?.getApps()},this.signalingClient.onAuthError=t=>{o("WS:onAuthError","Auth error:",t),this.updateWSStatus("error"),alert("Authentication failed: "+t.error),this.handleLogout()},this.signalingClient.onAppsListReceived=t=>{o("WS:onAppsListReceived","Apps list received:",JSON.stringify(t,null,2)),o("WS:onAppsListReceived","Number of apps:",t.apps?.length??0),t.apps.forEach((s,a)=>{o("WS:onAppsListReceived",`App ${a}:`,s),this.apps.set(s.appId,{id:s.appId,name:s.name,capabilities:s.capabilities,status:s.status})}),o("WS:onAppsListReceived","Total apps in map:",this.apps.size),this.renderAppList()},this.signalingClient.onAppStatus=t=>{o("WS:onAppStatus","App status update:",t);let s=this.apps.get(t.appId);s?(s.status=t.status,t.name&&(s.name=t.name),t.capabilities&&(s.capabilities=t.capabilities)):this.apps.set(t.appId,{id:t.appId,name:t.name||t.appId,capabilities:t.capabilities,status:t.status}),o("WS:onAppStatus","Apps map after update:",Array.from(this.apps.entries())),this.renderAppList()},this.signalingClient.onError=t=>{o("WS:onError","WebSocket error:",t),this.setStatus("Error: "+t.message,"error")},o("initializeWebSocket","Initializing WebRTC client"),this.webrtcClient=new E(this.signalingClient),this.webrtcClient.onDataChannelOpen=({appId:t})=>{o("WebRTC:onDataChannelOpen","Data channel opened:",t),this.setStatus("Connected to "+t,"success")},this.webrtcClient.onDataChannelClose=({appId:t})=>{o("WebRTC:onDataChannelClose","Data channel closed:",t),this.setStatus("Disconnected from "+t,"info"),this.connectedAppId===t&&(this.connectedAppId=null,this.reflectionClient=null)},this.webrtcClient.onError=({appId:t,message:s})=>{o("WebRTC:onError","WebRTC error:",t,s),this.setStatus("Error: "+s,"error")};try{o("initializeWebSocket","Connecting to WebSocket..."),await this.signalingClient.connect(),o("initializeWebSocket","WebSocket connect() returned")}catch(t){o("initializeWebSocket","Failed to connect to WebSocket:",t),this.updateWSStatus("error")}}updateWSStatus(e){this.wsStatusSpan.textContent=e,this.wsStatusSpan.className=`status-${e}`}renderAppList(){o("renderAppList","Rendering app list..."),o("renderAppList","All apps:",Array.from(this.apps.values()));let e=Array.from(this.apps.values()).filter(n=>n.status==="online");o("renderAppList","Online apps:",e),this.appSelectElement.innerHTML='<option value="">-- Select an Online App --</option>'+e.map(n=>`<option value="${n.id}">${this.escapeHtml(n.name)} (${this.escapeHtml(n.id)})</option>`).join(""),this.connectBtn.disabled=e.length===0,o("renderAppList","Connect button disabled:",this.connectBtn.disabled)}async handleConnectAndList(){let e=this.appSelectElement.value;if(o("handleConnectAndList","Selected app ID:",e),!e){alert("Please select an app");return}if(!this.webrtcClient){o("handleConnectAndList","WebRTC client not initialized"),alert("WebRTC client not initialized");return}try{this.setStatus("Connecting to app...","info"),this.connectBtn.disabled=!0,o("handleConnectAndList","Calling webrtcClient.connectToApp..."),await this.webrtcClient.connectToApp(e),this.connectedAppId=e,o("handleConnectAndList","Connected to app via WebRTC"),this.setStatus("Connected! Listing services...","info"),o("handleConnectAndList","Getting transport...");let n=this.webrtcClient.getTransport(e);if(o("handleConnectAndList","Transport:",n),!n)throw new Error("Failed to get transport");o("handleConnectAndList","Creating ReflectionClient..."),this.reflectionClient=new S(n),o("handleConnectAndList","Calling listServices...");let t=await this.reflectionClient.listServices({timeout:1e4});o("handleConnectAndList","listServices response:",t),this.displayResults(t),this.setStatus("Services listed successfully","success")}catch(n){o("handleConnectAndList","Error:",n),console.error("Failed to connect or list services:",n),this.setStatus("Error: "+n,"error"),alert("Failed to list services: "+n)}finally{this.connectBtn.disabled=!1}}displayResults(e){if(!e.services||e.services.length===0){this.resultsDiv.innerHTML='<div class="no-results">No services found</div>';return}let n=e.services.map(t=>{let s=t.methods&&t.methods.length>0?`<ul class="methods-list">
            ${t.methods.map(a=>`<li class="method-item">${this.escapeHtml(a)}</li>`).join("")}
          </ul>`:'<div class="no-methods">No methods</div>';return`
        <div class="service-card">
          <div class="service-name">${this.escapeHtml(t.name)}</div>
          <div class="service-methods">
            <div class="methods-header">Methods:</div>
            ${s}
          </div>
        </div>
      `}).join("");this.resultsDiv.innerHTML=`
      <div class="results-header">Found ${e.services.length} service(s)</div>
      <div class="services-container">${n}</div>
      <div class="results-footer">
        <button class="btn btn-secondary" onclick="window.reflectionUI.showRawJSON()">
          Show Raw JSON
        </button>
      </div>
    `,window.reflectionResponse=e}showRawJSON(){let e=window.reflectionResponse;if(!e){alert("No response data available");return}let n=JSON.stringify(e,null,2);this.resultsDiv.innerHTML=`
      <div class="results-header">Raw JSON Response</div>
      <pre class="raw-json">${this.escapeHtml(n)}</pre>
      <div class="results-footer">
        <button class="btn btn-secondary" onclick="location.reload()">
          Refresh Page
        </button>
      </div>
    `}setStatus(e,n){this.statusDiv.textContent=e,this.statusDiv.className=`status-message status-${n}`,this.statusDiv.style.display="block"}escapeHtml(e){let n=document.createElement("div");return n.textContent=e,n.innerHTML}};function N(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.reflectionUI=new w}):window.reflectionUI=new w}N();})();
